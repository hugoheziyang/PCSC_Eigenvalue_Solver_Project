\doxysection{solve\+\_\+shifted.\+hpp}
\hypertarget{solve__shifted_8hpp_source}{}\label{solve__shifted_8hpp_source}\index{power\_method/solve\_shifted.hpp@{power\_method/solve\_shifted.hpp}}
\mbox{\hyperlink{solve__shifted_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../matrix/matrix.hpp"{}}\ \ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../option/shifted\_option.hpp"{}}\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../core/types.hpp"{}}\ \ \ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <Eigen/Dense>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <Eigen/Sparse>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <Eigen/SparseLU>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <typeinfo>}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{template}\ <ScalarConcept\ Scalar>}
\DoxyCodeLine{00056\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Matrix<Scalar,\ Eigen::Dynamic,\ 1>}}}
\DoxyCodeLine{00057\ \mbox{\hyperlink{solve__shifted_8hpp_a6008b7a1caf6b498cd4ff8179de2b032}{solve\_shifted\_linear\_system}}(}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMatrix}{Matrix}}\&\ \mbox{\hyperlink{classMatrix}{A\_wrapped}},}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMatrix}{ShiftedOptions<Scalar>}}\&\ \mbox{\hyperlink{classMatrix}{opts}},}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Matrix<Scalar,\ Eigen::Dynamic,\ 1>}}\&\ \mbox{\hyperlink{classMatrix}{b}}}
\DoxyCodeLine{00061\ )\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/\ Basic\ checks\ common\ to\ both\ dense\ and\ sparse\ -\/-\/-\/-\/}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classMatrix}{A\_wrapped}}.\mbox{\hyperlink{classMatrix_ae7dc4eb628122570c89094a14dc0021f}{has\_value}}())\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ A\ is\ empty"{}});}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A\_wrapped}}.\mbox{\hyperlink{classMatrix_a336eeb12b216965b1030c5f0de2f418e}{scalar\_type}}()\ !=\ \textcolor{keyword}{typeid}(Scalar))\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ scalar\ type\ mismatch"{}});}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ ======================================================}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ Dense\ case}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ ======================================================}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A\_wrapped}}.\mbox{\hyperlink{classMatrix_a75e07c6e7201be7839b96eec1b719315}{isDense}}())\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }DenseMat\ =\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Matrix<Scalar,\ Eigen::Dynamic,\ Eigen::Dynamic>}};}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ DenseMat\&\ \mbox{\hyperlink{classMatrix}{A}}\ =\ \mbox{\hyperlink{classMatrix}{A\_wrapped}}.\mbox{\hyperlink{classMatrix_a97b8901a453cbdc94fc3fd4cb3e9d4dd}{cast}}<DenseMat>();}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A}}.rows()\ !=\ \mbox{\hyperlink{classMatrix}{A}}.cols())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ A\ must\ be\ square\ (dense\ case)"{}});}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A}}.rows()\ !=\ \mbox{\hyperlink{classMatrix}{b}}.size())\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ size\ mismatch\ between\ A\ and\ b\ (dense\ case)"{}});}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Form\ M\ =\ A\ -\/\ 位\ I}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ DenseMat\ \mbox{\hyperlink{classMatrix}{M}}\ =\ \mbox{\hyperlink{classMatrix}{A}};}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMatrix}{M}}.diagonal().array()\ -\/=\ \mbox{\hyperlink{classMatrix}{opts}}.shift;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::PartialPivLU<DenseMat>}}\ \mbox{\hyperlink{classMatrix}{lu}}(\mbox{\hyperlink{classMatrix}{M}});}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMatrix}{lu}}.solve(\mbox{\hyperlink{classMatrix}{b}});}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ ======================================================}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ Sparse\ case}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ ======================================================}}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keyword}{using\ }SparseMat\ =\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::SparseMatrix<Scalar>}};\ \ \textcolor{comment}{//\ canonical\ sparse\ type}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{const}\ SparseMat\&\ \mbox{\hyperlink{classMatrix}{A}}\ =\ \mbox{\hyperlink{classMatrix}{A\_wrapped}}.\mbox{\hyperlink{classMatrix_a97b8901a453cbdc94fc3fd4cb3e9d4dd}{cast}}<SparseMat>();}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A}}.rows()\ !=\ \mbox{\hyperlink{classMatrix}{A}}.cols())\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ A\ must\ be\ square\ (sparse\ case)"{}});}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{A}}.rows()\ !=\ \mbox{\hyperlink{classMatrix}{b}}.size())\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ size\ mismatch\ between\ A\ and\ b\ (sparse\ case)"{}});}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ Form\ M\ =\ A\ -\/\ 位\ I}}
\DoxyCodeLine{00107\ \ \ \ \ SparseMat\ \mbox{\hyperlink{classMatrix}{M}}\ =\ \mbox{\hyperlink{classMatrix}{A}};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ Subtract\ 位\ from\ each\ diagonal\ entry:\ M(i,i)\ -\/=\ 位.}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ coeffRef\ inserts\ the\ entry\ if\ it\ does\ not\ exist\ yet.}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Index}}\ \mbox{\hyperlink{classMatrix}{i}}\ =\ 0;\ \mbox{\hyperlink{classMatrix}{i}}\ <\ \mbox{\hyperlink{classMatrix}{M}}.rows();\ ++\mbox{\hyperlink{classMatrix}{i}})\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMatrix}{M}}.coeffRef(\mbox{\hyperlink{classMatrix}{i}},\ \mbox{\hyperlink{classMatrix}{i}})\ -\/=\ \mbox{\hyperlink{classMatrix}{opts}}.shift;}
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::SparseLU<SparseMat>}}\ \mbox{\hyperlink{classMatrix}{solver}};}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classMatrix}{solver}}.analyzePattern(\mbox{\hyperlink{classMatrix}{M}});}
\DoxyCodeLine{00117\ \ \ \ \ \mbox{\hyperlink{classMatrix}{solver}}.factorize(\mbox{\hyperlink{classMatrix}{M}});}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{solver}}.info()\ !=\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Success}})\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ SparseLU\ factorization\ failed"{}});}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Matrix<Scalar,\ Eigen::Dynamic,\ 1>}}\ \mbox{\hyperlink{classMatrix}{x}}\ =\ \mbox{\hyperlink{classMatrix}{solver}}.solve(\mbox{\hyperlink{classMatrix}{b}});}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMatrix}{solver}}.info()\ !=\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{Eigen::Success}})\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMatrix_a12d35ef1824cd847868a8703035b0d5d}{std::runtime\_error}}(\textcolor{stringliteral}{"{}solve\_shifted\_linear\_system:\ SparseLU\ solve\ failed"{}});}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMatrix}{x}};}
\DoxyCodeLine{00129\ \}}

\end{DoxyCode}
